/*! For license information please see 78.476385c3.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunktimesheets=self.webpackChunktimesheets||[]).push([[78],{11(e,t,s){s.d(t,{V:()=>o});s(43);var a=s(784);const r=(0,a.A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),n=(0,a.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var i=s(579);const o=e=>{let{selectedFounder:t,setSelectedFounder:s,title:a,foundersList:o=[]}=e;const c=a.startsWith("Welcome")?"".concat((()=>{const e=(new Date).getHours();return e<12?"Good morning":e<18?"Good afternoon":"Good evening"})(),", ").concat(a.replace("Welcome, ","")):a;return(0,i.jsxs)("header",{className:"top-bar",children:[(0,i.jsxs)("div",{className:"page-title",children:[(0,i.jsx)("h1",{children:c}),(0,i.jsx)("span",{className:"date-display",children:(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,i.jsxs)("div",{className:"founder-selector-container",children:[(0,i.jsx)(r,{size:18,style:{color:"var(--text-muted)",marginRight:"0.5rem"}}),(0,i.jsxs)("select",{value:t,onChange:e=>s?s(e.target.value):null,className:"founder-select",disabled:!s,children:[o.map(e=>(0,i.jsx)("option",{value:e,children:e},e)),0===o.length&&(0,i.jsx)("option",{children:t})]}),(0,i.jsx)(n,{size:14,style:{marginLeft:"0.5rem",opacity:.5}})]})]})}},21(e,t,s){s.d(t,{Ek:()=>d,J3:()=>m,LF:()=>l,vD:()=>u});var a=s(555),r=s(43),n=s(667),i=s(791),o=s(217);const c=()=>(0,n.rJ)(i.db,"artifacts",o.sZ,"public","data",o.LL),d=(e,t)=>{const[s,i]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!e)return i(null),void d(!1);const s=setTimeout(()=>{d(!1)},3e3),r=(0,n.P)(c(),(0,n._M)("founder","==",t),(0,n._M)("endTime","==",null),(0,n.AB)(1)),o=(0,n.aQ)(r,e=>{clearTimeout(s);let t=null;if(!e.empty){var r;const s=e.docs[0];t=(0,a.A)((0,a.A)({id:s.id},s.data()),{},{startTime:null===(r=s.data().startTime)||void 0===r?void 0:r.toDate()})}i(t),d(!1)},e=>{console.error("Active entry error:",e),"failed-precondition"===e.code&&console.error("\ud83d\udd25 MISSING INDEX: Open this link to fix ->",e.message),d(!1)});return()=>{o(),clearTimeout(s)}},[e,t]),{activeEntry:s,loading:o}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const[s,i]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!e)return i([]),void d(!1);const s=setTimeout(()=>{d(!1)},3e3),r=(0,n.P)(c(),(0,n.My)("startTime","desc"),(0,n.AB)(t)),o=(0,n.aQ)(r,e=>{clearTimeout(s);const t=e.docs.map(e=>{var t,s;return(0,a.A)((0,a.A)({id:e.id},e.data({serverTimestamps:"estimate"})),{},{startTime:null===(t=e.data({serverTimestamps:"estimate"}).startTime)||void 0===t?void 0:t.toDate(),endTime:null===(s=e.data({serverTimestamps:"estimate"}).endTime)||void 0===s?void 0:s.toDate()})});i(t),d(!1)},e=>{console.error("Recent entries error:",e),"failed-precondition"===e.code&&console.warn("\ud83d\udd25 MISSING INDEX for Recent Entries. Check console for link."),d(!1)});return()=>{o(),clearTimeout(s)}},[e,t]),{entries:s,loading:o}},m=e=>{const[t,s]=(0,r.useState)({monthTotal:0,yearTotal:0,founderStats:{},activeCount:0}),[a,c]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!e)return void c(!1);const t=setTimeout(()=>{c(!1)},3e3),a=(0,n.H9)(i.db,"artifacts",o.sZ,"public","data","stats","aggregate"),r=(0,n.aQ)(a,e=>{if(clearTimeout(t),e.exists()){const t=e.data();s(t)}else console.warn("Stats document doesn't exist. Please ensure write operations update aggregates."),s({monthTotal:0,yearTotal:0,founderStats:{},activeCount:0});c(!1)},e=>{console.error("Stats snapshot error:",e),c(!1)});return()=>{r(),clearTimeout(t)}},[e]),{stats:t,loading:a}},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[s,i]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!e&&!t)return i([]),void d(!1);const s=(0,n.P)(c(),(0,n.My)("startTime","desc"),(0,n.AB)(100)),r=(0,n.aQ)(s,e=>{const t=e.docs.map(e=>{var t,s;return(0,a.A)((0,a.A)({id:e.id},e.data({serverTimestamps:"estimate"})),{},{startTime:null===(t=e.data({serverTimestamps:"estimate"}).startTime)||void 0===t?void 0:t.toDate(),endTime:null===(s=e.data({serverTimestamps:"estimate"}).endTime)||void 0===s?void 0:s.toDate()})});i(t),d(!1)},e=>{console.error("Timesheets snapshot error:",e),d(!1)});return()=>r()},[e]),{entries:s,loading:o}}},78(e,t,s){s.d(t,{Timesheets:()=>v});var a=s(43),r=s(978),n=s(855),i=s(667),o=s(791),c=s(21),d=s(11),l=s(217),m=s(829);const u=(0,s(784).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var h=s(579);const v=e=>{let{user:t,forcedFounder:s,isAdmin:v}=e;const[g,f]=(0,a.useState)(s||l.$h[0]),[p,y]=(0,a.useState)(""),{entries:T,loading:x}=(0,c.vD)(t,v),j=async e=>{if(window.confirm("Are you sure you want to delete this entry?"))try{const t=(0,i.H9)(o.db,"artifacts",l.sZ,"public","data",l.LL,e),s=await(0,i.x7)(t);if(s.exists()){const e=s.data();if(e.endTime&&"active"!==e.status){if(e.endTime&&e.startTime){const t=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),s=(e.endTime.toDate?e.endTime.toDate():new Date(e.endTime)).getTime()-t.getTime();await(async(e,t,s)=>{try{const a=(0,i.H9)(o.db,"artifacts",l.sZ,"public","data","stats","aggregate"),r=new Date,n=s||r,c=n.getMonth()===r.getMonth()&&n.getFullYear()===r.getFullYear(),d=n.getFullYear()===r.getFullYear(),m={year:(0,i.GV)(t)};c&&(m.month=(0,i.GV)(t));const u={founderStats:{[e]:m}};d&&(u.yearTotal=(0,i.GV)(t)),c&&(u.monthTotal=(0,i.GV)(t)),await(0,i.BN)(a,u,{merge:!0})}catch(a){console.error("Failed to update stats:",a)}})(e.founder,-s,t)}}else await(async e=>{try{const t=(0,i.H9)(o.db,"artifacts",l.sZ,"public","data","stats","aggregate");await(0,i.BN)(t,{activeCount:(0,i.GV)(e)},{merge:!0})}catch(t){console.error(t)}})(-1)}await(0,i.kd)(t)}catch(t){console.error("Error deleting:",t)}};if(x)return(0,h.jsx)("div",{children:"Loading..."});const k=v?T.filter(e=>e.founder.toLowerCase().includes(p.toLowerCase())):T.filter(e=>e.founder===g);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(d.V,{selectedFounder:g,setSelectedFounder:s||v?void 0:f,title:v?"Admin Timesheets":s?"My Timesheet History":"Timesheet History",foundersList:v?[]:s?[s]:l.$h}),v&&(0,h.jsx)("div",{style:{marginTop:"2rem",marginBottom:"1rem"},children:(0,h.jsxs)("div",{style:{position:"relative",maxWidth:"400px"},children:[(0,h.jsx)(u,{size:20,style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"}}),(0,h.jsx)("input",{type:"text",placeholder:"Search by founder name...",value:p,onChange:e=>y(e.target.value),className:"custom-input",style:{paddingLeft:"2.5rem"}})]})}),(0,h.jsxs)("div",{className:"card history-section",style:{marginTop:"2rem"},children:[(0,h.jsxs)("h3",{style:{fontSize:"1.1rem",margin:"0 0 1.5rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,h.jsx)(r.A,{size:20})," ",v?"All Entries (".concat(k.length,")"):"All Entries (Year To Date)"]}),0===k.length?(0,h.jsx)("div",{style:{padding:"3rem",textAlign:"center",color:"var(--text-muted)"},children:v&&p?"No matching records found.":"No activities recorded yet."}):(0,h.jsx)("ul",{className:"history-list",children:k.map(e=>{const t=e.startTime,s=e.endTime;let a="Active";s&&t&&(a=(0,m.a3)(s-t));const r=(0,m.IM)(e.founder),i=l.$h.indexOf(e.founder)%4,o=["#4361ee","#7209b7","#f72585","#4cc9f0"],c=o[Math.max(0,i)]||o[0];return(0,h.jsxs)("li",{className:"history-item",children:[(0,h.jsx)("div",{className:"history-avatar",style:{background:"".concat(c,"20"),color:c},children:r}),(0,h.jsxs)("div",{className:"history-content",children:[(0,h.jsx)("div",{className:"history-task",children:e.task}),(0,h.jsxs)("div",{className:"history-meta",children:[(0,h.jsx)("span",{children:e.founder}),(0,h.jsx)("span",{children:"\u2022"}),(0,h.jsx)("span",{children:t?(0,m.Yq)(t):"Unknown Date"}),(0,h.jsx)("span",{children:"\u2022"}),(0,h.jsxs)("span",{children:[t?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"," -",s?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Now"]})]})]}),(0,h.jsx)("span",{className:"history-duration",style:s?{}:{color:"#10b981",background:"#d1fae5"},children:a}),(0,h.jsx)("button",{onClick:()=>j(e.id),className:"history-delete-btn",title:"Delete",children:(0,h.jsx)(n.A,{size:16})})]},e.id)})})]})]})}},829(e,t,s){s.d(t,{IM:()=>n,Yq:()=>r,a3:()=>a});const a=e=>{if(!e&&0!==e)return"0h 0m";const t=Math.floor(e/6e4);if(0===t)return"< 1m";const s=Math.floor(t/60),a=t%60;return"".concat(s,"h ").concat(a,"m")},r=e=>e?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(e):"",n=e=>e?e.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase():"?"},855(e,t,s){s.d(t,{A:()=>a});const a=(0,s(784).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])}}]);
//# sourceMappingURL=78.476385c3.chunk.js.map